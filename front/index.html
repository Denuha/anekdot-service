<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <style>
      .hidden {
          display:none;
      }
  </style>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
  <script src="js/main.js"></script>
  <script>
      $(document).on("ready", () => {
        $(document).on("click", ".random-anekdot", function(){
            $.ajax({
                url: 'http://192.168.0.103:1337/api/v1/anekdot/random',
                method: 'GET',
                dataType: 'json',
                data: {},
                success: function(result){
                    console.log(result);
                    let id =  result.resp.ID;
                    $(".rating-buttons__container").removeClass("hidden");
                    $(".anekdot-text").text(result.resp.Text);
                    $(".anekdot-info").text("ID: " + id + " Rating: " + result.resp.Rating + " Date: " + result.resp.CreateTime);
                    $(".anekdot-info").attr("data-anekdot-id", id);
                }
            });
        });         
        $(document).on("click", ".rating-vote", function(){
            let data = {};
            data["method"] = $(this).data("method");
            data["id"] = $(".anekdot-info").data("anekdot-id");
            
            let url = 'http://192.168.0.103:1337/api/v1/anekdot/' + data["id"] + '/rating?method=' + data["method"];
            console.log(data);
            console.log(url);
            if(!data["method"] || !url || !data["id"]) {
                $(".error-text").text("error!");
                return;
            }
            $.ajax({
                url: url,
                type: 'PUT',
                success: function(result){
                    $(".buttons__container").addClass("hidden");
                }
            });
        })
})
  </script>
  <title>Анекдоты</title>
 </head>
 <body>
     <div>
         <button class="random-anekdot">Анекдот</button>
         <button class="parse">Обновить базу</button>
     </div>
  <p>Привет, мир</p>
  <p class="anekdot-text"></p>
  <p class="anekdot-info"></p>
  <div class="rating-buttons__container hidden">
      <button class="rating-vote" data-method="inc">Like</button>
      <button class="rating-vote" data-method="dec">Dislike</button>
  </div>
  <div class="error-text"></div>
  
  
 </body>
</html>

